# Kimfe Markdown Convention (KMC) - Guía de Sintaxis | Syntax Guide

_Español | Spanish_

Esta guía detalla la sintaxis completa para crear documentos y plantillas con KMC (Kimfe Markdown Convention).

_English | Inglés_

This guide details the complete syntax for creating documents and templates with KMC (Kimfe Markdown Convention).

## 1. Estructura Básica de Variables | Basic Variable Structure

KMC define tres tipos fundamentales de variables con sintaxis diferenciada:
*KMC defines three fundamental types of variables with differentiated syntax:*

### 1.1 Variables Contextuales | Contextual Variables `[[tipo:nombre]]`

_Español_

Representan datos estáticos o contextuales que se obtienen de fuentes como bases de datos, configuraciones de proyecto, o información de usuario. Estas variables se reemplazan directamente con su valor correspondiente.

_English_

Represent static or contextual data obtained from sources such as databases, project configurations, or user information. These variables are replaced directly with their corresponding value.

```markdown
[[project:nombre_proyecto]]  # Nombre del proyecto desde la base de datos | Project name from database
[[user:email]]               # Email del usuario actual | Current user's email
[[org:nombre_empresa]]       # Nombre de la organización | Organization name
```

#### Tipos de Variables Contextuales Comunes | Common Contextual Variable Types:

| Prefijo | Descripción | Description | Ejemplos | Examples |
|---------|-------------|-------------|----------|----------|
| `project` | Datos del proyecto | Project data | `[[project:id]]`, `[[project:nombre]]` |
| `user` | Datos del usuario | User data | `[[user:email]]`, `[[user:nombre]]` |
| `org` | Datos de organización | Organization data | `[[org:nombre]]`, `[[org:industria]]` |
| `config` | Configuraciones | Configurations | `[[config:idioma]]`, `[[config:zona_horaria]]` |

### 1.2 Variables de Metadata | Metadata Variables `[{tipo:nombre}]`

_Español_

Representan información específica del documento o contenido relacionado, como referencias a la base de conocimiento o números de versión.

_English_

Represent specific information about the document or related content, such as references to the knowledge base or version numbers.

```markdown
[{doc:version}]          # Versión del documento actual | Current document version
[{kb:cita_1}]            # Referencia a un fragmento de la base de conocimiento | Reference to a knowledge base fragment
[{doc:numero_modulo}]    # Número de módulo en un curso | Module number in a course
```

#### Tipos de Variables de Metadata Comunes | Common Metadata Variable Types:

| Prefijo | Descripción | Description | Ejemplos | Examples |
|---------|-------------|-------------|----------|----------|
| `doc` | Metadata del documento | Document metadata | `[{doc:version}]`, `[{doc:autor}]` |
| `kb` | Base de conocimiento | Knowledge base | `[{kb:cita_1}]`, `[{kb:referencia}]` |
| `ref` | Referencias cruzadas | Cross-references | `[{ref:tabla_1}]`, `[{ref:seccion_2}]` |

### 1.3 Variables Generativas | Generative Variables `{{categoria:subtipo:nombre}}`

_Español_

Representan contenido generado dinámicamente por IA, APIs, herramientas u otros servicios. Estas variables se procesan en tiempo de renderizado para generar su contenido.

_English_

Represent content dynamically generated by AI, APIs, tools, or other services. These variables are processed at render time to generate their content.

```markdown
{{ai:gpt4:resumen_ejecutivo}}       # Resumen generado por GPT-4 | Summary generated by GPT-4
{{api:weather:pronostico_semanal}}  # Datos de pronóstico de API del tiempo | Weather forecast data from API
{{tool:sentiment:analisis_tweets}}  # Análisis de sentimiento de tweets | Sentiment analysis of tweets
```

#### Categorías Generativas Comunes | Common Generative Categories:

| Categoría | Descripción | Description | Ejemplos | Examples |
|-----------|-------------|-------------|----------|----------|
| `ai` | Modelos de IA | AI models | `{{ai:gpt4:resumen}}`, `{{ai:claude:analisis}}` |
| `api` | APIs externas | External APIs | `{{api:finance:cotizacion}}`, `{{api:weather:clima}}` |
| `tool` | Herramientas/algoritmos | Tools/algorithms | `{{tool:ocr:texto}}`, `{{tool:sentiment:score}}` |
| `calc` | Cálculos/fórmulas | Calculations/formulas | `{{calc:financiero:roi}}`, `{{calc:stats:promedio}}` |
| `mcp` | Model Context Protocol | Model Context Protocol | `{{mcp:blockchain:verificacion}}`, `{{mcp:db:consulta}}` |

## 2. Instrucciones para Variables Generativas | Instructions for Generative Variables

_Español_

Las instrucciones para variables generativas se definen en comentarios HTML.

_English_

Instructions for generative variables are defined in HTML comments.

### 2.1 Estructura de Comentarios de Instrucciones | Instruction Comment Structure

```markdown
<!-- TIPO_INSTRUCCION FOR {{variable}}: 
Contenido de la instrucción 
-->
```

Tipos de instrucciones comunes | Common instruction types:

| Tipo Instrucción | Uso | Use | Ejemplo | Example |
|------------------|-----|-----|---------|---------|
| `AI_PROMPT` | Instrucciones para modelos de IA | Instructions for AI models | `<!-- AI_PROMPT FOR {{ai:gpt4:resumen}}: ... -->` |
| `API_SOURCE` | Configuración para llamadas API | Configuration for API calls | `<!-- API_SOURCE: https://api.example.com/v1/data -->` |
| `TOOL_CONFIG` | Configuración para herramientas | Configuration for tools | `<!-- TOOL_CONFIG FOR {{tool:ocr:texto}}: idioma=es -->` |
| `CALC_FORMULA` | Fórmulas para cálculos | Formulas for calculations | `<!-- CALC_FORMULA: (valor1 + valor2) / 2 -->` |

### 2.3 Definiciones Integradas de Variables (KMC_DEFINITION) | Integrated Variable Definitions

_Español_

Esta sintaxis es fundamental para KMC y establece una regla clara: para que una variable de metadata (ej. `[{doc:mi_variable}]`) sea renderizada con contenido generado, **debe existir como un placeholder en el cuerpo del documento Y además tener un bloque `KMC_DEFINITION` asociado.**

El bloque `KMC_DEFINITION FOR [{doc:mi_variable}]` no inserta contenido directamente en su propia ubicación. En su lugar, define cómo se generará el contenido para todas las instancias del placeholder `[{doc:mi_variable}]` que se encuentren en el documento. Esta definición es global para el documento una vez declarada y puede ser capturada por el SDK para su reutilización.

#### Reglas de Renderizado | Rendering Rules

**Regla fundamental**: 
- Las variables que comienzan con `[]` (formato `[{tipo:nombre}]`) serán renderizadas una vez procesadas por el sistema.
- Las variables que comienzan con `{}` (formato `{{categoria:subtipo:nombre}}`) nunca serán renderizadas directamente, sino que se utilizan como fuentes generativas en las definiciones.

Esta distinción es importante porque separa claramente las declaraciones de variables (placeholders donde aparecerá el contenido) de las fuentes que generan dicho contenido.

Ejemplo de uso:
```markdown
[{doc:objetivos_de_aprendizaje}]
<!-- KMC_DEFINITION FOR [{doc:objetivos_de_aprendizaje}]:
GENERATIVE_SOURCE = {{ai:gpt4:extract_title}}
PROMPT = "Extrae un listado de objetivos y resultados de aprendizaje a partir de  [{kb:contenido}]. Se definen tantos RA y OA como sean necesarios para cubrir los objetivos de aprendizaje"
FORMAT = "Listado en formato RA1: Resultado de aprendizaje 1, OA1.1 Objetivo de aprendizaje 1 asociado RA1, OA1.2 Objetivo de aprendizaje 2 asociado RA1, "
-->
```

_English_

This syntax is fundamental to KMC and establishes a clear rule: for a metadata variable (e.g., `[{doc:my_variable}]`) to be rendered with generated content, **it must exist as a placeholder in the document body AND also have an associated `KMC_DEFINITION` block.**

The `KMC_DEFINITION FOR [{doc:my_variable}]` block does not directly insert content at its own location. Instead, it defines how content will be generated for all instances of the `[{doc:my_variable}]` placeholder found within the document. This definition is global for the document once declared and can be captured by the SDK for reuse.

#### Rendering Rules

**Fundamental rule**:
- Variables that begin with `[]` (format `[{type:name}]`) will be rendered once processed by the system.
- Variables that begin with `{}` (format `{{category:subtype:name}}`) will never be rendered directly, but are used as generative sources in definitions.

This distinction is important because it clearly separates variable declarations (placeholders where content will appear) from the sources that generate that content.

Usage example:
```markdown
[{doc:learning_objectives}]
<!-- KMC_DEFINITION FOR [{doc:learning_objectives}]:
GENERATIVE_SOURCE = {{ai:gpt4:extract_title}}
PROMPT = "Extract a list of learning objectives and outcomes from [{kb:content}]. Define as many LOs and LOs as needed to cover the learning objectives"
FORMAT = "List in format LO1: Learning outcome 1, OBJ1.1 Learning objective 1 associated with LO1, OBJ1.2 Learning objective 2 associated with LO1, "
-->
```

## 7. Mejores Prácticas | Best Practices

1. **Nombrado de Variables | Variable Naming:**
   - Usa `snake_case` para todas las variables | Use `snake_case` for all variables
   - Nombres descriptivos pero concisos | Descriptive but concise names
   - Mantén consistencia en toda la plantilla | Maintain consistency throughout the template

2. **Prompts Efectivos | Effective Prompts:**
   - Sé específico sobre el formato deseado | Be specific about the desired format
   - Incluye contexto relevante | Include relevant context
   - Establece límites claros (longitud, estilo, tono) | Set clear limits (length, style, tone)

3. **Estructura del Documento | Document Structure:**
   - Usa encabezados jerárquicos (# para título, ## para secciones principales) | Use hierarchical headings (# for title, ## for main sections)
   - Agrupa bloques KMC_DEFINITION relacionados | Group related KMC_DEFINITION blocks
   - Coloca las definiciones KMC_DEFINITION cerca del principio del documento o cerca de donde se utiliza por primera vez el placeholder | Place KMC_DEFINITION blocks near the beginning of the document or near where the placeholder is first used

4. **Declaración y Definición con `KMC_DEFINITION` (Regla Fundamental):**
   - _Español_: Para que una variable de metadata (ej. `[{doc:mi_contenido_dinamico}]`) muestre contenido generado, primero debe ser **declarada como un placeholder** en la ubicación deseada dentro del cuerpo del documento. Segundo, debe existir un bloque `<!-- KMC_DEFINITION FOR [{doc:mi_contenido_dinamico}]: ... -->` que defina su fuente generativa y prompt. Esta definición es global para el documento y el SDK puede capturarla para su reutilización.
   
   - _English_: For a metadata variable (e.g., `[{doc:my_dynamic_content}]`) to display generated content, it must first be **declared as a placeholder** at the desired location within the document body. Second, there must be a `<!-- KMC_DEFINITION FOR [{doc:my_dynamic_content}]: ... -->` block that defines its generative source and prompt. This definition is global for the document and the SDK can capture it for reuse.

5. **Reglas de Renderizado | Rendering Rules:**
   - _Español_: Recuerda la regla fundamental: las variables con formato `[{tipo:nombre}]` se renderizan con su contenido, mientras que las variables con formato `{{categoria:subtipo:nombre}}` NUNCA se renderizan directamente (solo se usan como fuentes generativas).
   
   - _English_: Remember the fundamental rule: variables with format `[{type:name}]` are rendered with their content, while variables with format `{{category:subtype:name}}` are NEVER rendered directly (they are only used as generative sources).

6. **Reutilización de Variables | Variable Reuse:**
   - Define variables comunes al inicio del documento | Define common variables at the beginning of the document
   - Reutiliza las mismas variables para contenido similar | Reuse the same variables for similar content
   - Aprovecha la capacidad del SDK para capturar definiciones | Take advantage of the SDK's ability to capture definitions