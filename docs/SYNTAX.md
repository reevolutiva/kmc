# Kimfe Markdown Convention (KMC) - Guía de Sintaxis | Syntax Guide

_Español | Spanish_

Esta guía detalla la sintaxis completa para crear documentos y plantillas con KMC (Kimfe Markdown Convention).

_English | Inglés_

This guide details the complete syntax for creating documents and templates with KMC (Kimfe Markdown Convention).

## 1. Estructura Básica de Variables | Basic Variable Structure

KMC define tres tipos fundamentales de variables con sintaxis diferenciada:
*KMC defines three fundamental types of variables with differentiated syntax:*

### 1.1 Variables Contextuales | Contextual Variables `[[tipo:nombre]]`

_Español_

Representan datos estáticos o contextuales que se obtienen de fuentes como bases de datos, configuraciones de proyecto, o información de usuario. Estas variables se reemplazan directamente con su valor correspondiente.

_English_

Represent static or contextual data obtained from sources such as databases, project configurations, or user information. These variables are replaced directly with their corresponding value.

```markdown
[[project:nombre_proyecto]]  # Nombre del proyecto desde la base de datos | Project name from database
[[user:email]]               # Email del usuario actual | Current user's email
[[org:nombre_empresa]]       # Nombre de la organización | Organization name
```

#### Tipos de Variables Contextuales Comunes | Common Contextual Variable Types:

| Prefijo | Descripción | Description | Ejemplos | Examples |
|---------|-------------|-------------|----------|----------|
| `project` | Datos del proyecto | Project data | `[[project:id]]`, `[[project:nombre]]` |
| `user` | Datos del usuario | User data | `[[user:email]]`, `[[user:nombre]]` |
| `org` | Datos de organización | Organization data | `[[org:nombre]]`, `[[org:industria]]` |
| `config` | Configuraciones | Configurations | `[[config:idioma]]`, `[[config:zona_horaria]]` |

### 1.2 Variables de Metadata | Metadata Variables `[{tipo:nombre}]`

_Español_

Representan información específica del documento o contenido relacionado, como referencias a la base de conocimiento o números de versión.

_English_

Represent specific information about the document or related content, such as references to the knowledge base or version numbers.

```markdown
[{doc:version}]          # Versión del documento actual | Current document version
[{kb:cita_1}]            # Referencia a un fragmento de la base de conocimiento | Reference to a knowledge base fragment
[{doc:numero_modulo}]    # Número de módulo en un curso | Module number in a course
```

#### Tipos de Variables de Metadata Comunes | Common Metadata Variable Types:

| Prefijo | Descripción | Description | Ejemplos | Examples |
|---------|-------------|-------------|----------|----------|
| `doc` | Metadata del documento | Document metadata | `[{doc:version}]`, `[{doc:autor}]` |
| `kb` | Base de conocimiento | Knowledge base | `[{kb:cita_1}]`, `[{kb:referencia}]` |
| `ref` | Referencias cruzadas | Cross-references | `[{ref:tabla_1}]`, `[{ref:seccion_2}]` |

### 1.3 Variables Generativas | Generative Variables `{{categoria:subtipo:nombre}}`

_Español_

Representan contenido generado dinámicamente por IA, APIs, herramientas u otros servicios. Estas variables se procesan en tiempo de renderizado para generar su contenido.

_English_

Represent content dynamically generated by AI, APIs, tools, or other services. These variables are processed at render time to generate their content.

```markdown
{{ai:gpt4:resumen_ejecutivo}}       # Resumen generado por GPT-4 | Summary generated by GPT-4
{{api:weather:pronostico_semanal}}  # Datos de pronóstico de API del tiempo | Weather forecast data from API
{{tool:sentiment:analisis_tweets}}  # Análisis de sentimiento de tweets | Sentiment analysis of tweets
```

#### Categorías Generativas Comunes | Common Generative Categories:

| Categoría | Descripción | Description | Ejemplos | Examples |
|-----------|-------------|-------------|----------|----------|
| `ai` | Modelos de IA | AI models | `{{ai:gpt4:resumen}}`, `{{ai:claude:analisis}}` |
| `api` | APIs externas | External APIs | `{{api:finance:cotizacion}}`, `{{api:weather:clima}}` |
| `tool` | Herramientas/algoritmos | Tools/algorithms | `{{tool:ocr:texto}}`, `{{tool:sentiment:score}}` |
| `calc` | Cálculos/fórmulas | Calculations/formulas | `{{calc:financiero:roi}}`, `{{calc:stats:promedio}}` |
| `mcp` | Model Context Protocol | Model Context Protocol | `{{mcp:blockchain:verificacion}}`, `{{mcp:db:consulta}}` |

## 2. Instrucciones para Variables Generativas | Instructions for Generative Variables

_Español_

Las instrucciones para variables generativas se definen en comentarios HTML.

_English_

Instructions for generative variables are defined in HTML comments.

### 2.1 Estructura de Comentarios de Instrucciones | Instruction Comment Structure

```markdown
<!-- TIPO_INSTRUCCION FOR {{variable}}: 
Contenido de la instrucción 
-->
```

Tipos de instrucciones comunes | Common instruction types:

| Tipo Instrucción | Uso | Use | Ejemplo | Example |
|------------------|-----|-----|---------|---------|
| `AI_PROMPT` | Instrucciones para modelos de IA | Instructions for AI models | `<!-- AI_PROMPT FOR {{ai:gpt4:resumen}}: ... -->` |
| `API_SOURCE` | Configuración para llamadas API | Configuration for API calls | `<!-- API_SOURCE: https://api.example.com/v1/data -->` |
| `TOOL_CONFIG` | Configuración para herramientas | Configuration for tools | `<!-- TOOL_CONFIG FOR {{tool:ocr:texto}}: idioma=es -->` |
| `CALC_FORMULA` | Fórmulas para cálculos | Formulas for calculations | `<!-- CALC_FORMULA: (valor1 + valor2) / 2 -->` |

### 2.3 Definiciones Integradas de Variables (KMC_DEFINITION) | Integrated Variable Definitions

_Español_

Esta sintaxis permite definir la relación entre variables de metadata y su contenido generativo de forma más declarativa y autocontenida:

_English_

This syntax allows defining the relationship between metadata variables and their generative content in a more declarative and self-contained way:

```markdown
<!-- KMC_DEFINITION FOR [{doc:titulo_modulo}]:
GENERATIVE_SOURCE = {{ai:gpt4:extract_title}}
PROMPT = "Extrae el título principal del módulo basándote en [{kb:contenido}]"
FORMAT = "text/plain; max_length=80"
-->

## [{doc:titulo_modulo}]

...contenido del módulo...
```

#### Estructura | Structure

```
<!-- KMC_DEFINITION FOR [{variable_metadata}]:
GENERATIVE_SOURCE = {{variable_generativa}}
PROMPT = "Instrucción para generar el contenido"
FORMAT = "formato_deseado; parámetros_adicionales"
-->
```

#### Parámetros | Parameters

| Parámetro | Parameter | Requerido | Required | Descripción | Description |
|-----------|-----------|-----------|----------|-------------|-------------|
| `GENERATIVE_SOURCE` | Yes | Sí | Variable generativa que producirá el contenido | Generative variable that will produce the content |
| `PROMPT` | Yes | Sí | Instrucción clara para generar el valor (puede incluir otras variables) | Clear instruction to generate the value (may include other variables) |
| `FORMAT` | No | No | Especificación del formato deseado para la salida | Specification of the desired output format |

#### Ejemplos de Uso | Usage Examples

**Ejemplo 1: Extracción de información | Example 1: Information extraction**
```markdown
<!-- KMC_DEFINITION FOR [{doc:nombre_modulo}]:
GENERATIVE_SOURCE = {{ai:gpt4:extract_module_name}}
PROMPT = "Analiza la documentación de [{kb:docs}] y determina el nombre del módulo actual"
FORMAT = "text/plain; max_length=100"
-->

# Módulo: [{doc:nombre_modulo}]
```

**Ejemplo 2: Generación de contenido educativo | Example 2: Educational content generation**
```markdown
<!-- KMC_DEFINITION FOR [{doc:objetivos_aprendizaje}]:
GENERATIVE_SOURCE = {{ai:gpt4:gen_learning_objectives}}
PROMPT = "Basado en el contenido de [[project:curriculum]] y [{kb:tema_actual}], genera 3-5 objetivos de aprendizaje claros y medibles para este módulo"
FORMAT = "markdown; bullet_list"
-->

## Objetivos de Aprendizaje

[{doc:objetivos_aprendizaje}]
```

**Ejemplo 3: Múltiples secciones con un patrón | Example 3: Multiple sections with a pattern**
```markdown
<!-- KMC_DEFINITION FOR [{doc:section_*}]:
GENERATIVE_SOURCE = {{ai:gpt4:gen_section}}
PROMPT_TEMPLATE = "Genera una sección sobre {topic} para el curso [[project:nombre]]"
TOPICS = ["introduccion", "conceptos_basicos", "casos_avanzados"]
FORMAT = "markdown"
-->

## [{doc:section_introduccion}]

## [{doc:section_conceptos_basicos}]

## [{doc:section_casos_avanzados}]
```

#### Ventajas de esta Sintaxis | Advantages of this Syntax

- **Declarativa | Declarative**: Define claramente la relación entre variables | Clearly defines the relationship between variables
- **Autocontenida | Self-contained**: Todo en un mismo lugar (metadata, fuente generativa, instrucciones) | Everything in one place (metadata, generative source, instructions)
- **Trazable | Traceable**: Facilita ver qué genera cada valor | Makes it easy to see what generates each value
- **No invasiva | Non-invasive**: Los comentarios HTML no interrumpen visualmente el documento final | HTML comments don't visually interrupt the final document
- **Extensible | Extensible**: Se pueden añadir nuevos parámetros al formato según sea necesario | New parameters can be added to the format as needed

## 3. Encadenamiento de Variables | Variable Chaining

### 3.1 Referencias en Prompts | References in Prompts

_Español_

Las variables pueden referenciarse dentro de las instrucciones de otras variables:

_English_

Variables can be referenced within instructions for other variables:

```markdown
{{api:finance:datos_mercado}}
<!-- API_SOURCE: https://api.market.com/v1/sector_analysis?industry=[[project:industria]] -->

{{ai:gpt4:analisis_mercado}}
<!-- AI_PROMPT FOR {{ai:gpt4:analisis_mercado}}: 
Analiza los siguientes datos de mercado y extrae las 3 tendencias principales:
{{api:finance:datos_mercado}}
-->
```

### 3.2 Variables de Contexto en Prompts | Context Variables in Prompts

```markdown
<!-- AI_PROMPT FOR {{ai:gpt4:resumen_legal}}: 
Genera un resumen legal considerando:
- País: [[org:pais]]
- Industria: [[project:industria]]
- Regulaciones: [{kb:regulaciones_aplicables}]
-->
```

## 4. Lógica de Control | Control Logic

### 4.1 Bucles (Iteración) | Loops (Iteration)

_Español_

Para iterar sobre colecciones de datos:

_English_

To iterate over data collections:

```markdown
## Entregables del Proyecto | Project Deliverables
{{#each project:entregables}}
- **[{doc:nombre_entregable}]:** [{doc:descripcion_entregable}]
  *Estado | Status:* {{tool:workflow:estado_entregable}}
{{/each}}
```

### 4.2 Condicionales | Conditionals

_Español_

Para inclusión condicional de contenido:

_English_

For conditional inclusion of content:

```markdown
{{#if project:tiene_financiamiento}}
## Presupuesto | Budget
{{ai:gpt4:desglose_presupuesto}}
<!-- AI_PROMPT FOR {{ai:gpt4:desglose_presupuesto}}: 
Genera una tabla con el desglose del presupuesto del proyecto.
-->
{{else}}
## Propuesta de Financiamiento | Funding Proposal
{{ai:gpt4:propuesta_financiamiento}}
<!-- AI_PROMPT FOR {{ai:gpt4:propuesta_financiamiento}}:
Genera una propuesta para obtener financiamiento para este proyecto.
-->
{{/if}}
```

## 5. Sintaxis Especial | Special Syntax

### 5.1 Formatos Específicos | Specific Formats

_Español_

Para ciertos tipos de contenido generado, se pueden especificar formatos:

_English_

For certain types of generated content, formats can be specified:

```markdown
{{ai:gpt4:tabla_resumen format=markdown_table}}
<!-- AI_PROMPT FOR {{ai:gpt4:tabla_resumen}}: 
Genera una tabla comparativa de los principales competidores.
-->

{{ai:gpt4:diagrama format=mermaid}}
<!-- AI_PROMPT FOR {{ai:gpt4:diagrama}}: 
Crea un diagrama de flujo del proceso descrito en el proyecto.
-->
```

### 5.2 Parámetros Adicionales | Additional Parameters

_Español_

Se pueden especificar parámetros adicionales para modificar el comportamiento de la variable:

_English_

Additional parameters can be specified to modify the behavior of the variable:

```markdown
{{ai:gpt4:resumen_ejecutivo max_tokens=300 temperature=0.7}}
<!-- AI_PROMPT FOR {{ai:gpt4:resumen_ejecutivo}}: 
Genera un resumen ejecutivo conciso del proyecto.
-->
```

## 6. Ejemplo Completo | Complete Example

```markdown
# [[project:nombre]] (v[{doc:version}])

**Cliente | Client:** [[org:nombre_empresa]]
**Fecha | Date:** [[project:fecha_inicio]]
**Autor | Author:** [[user:nombre_completo]]

## Resumen Ejecutivo | Executive Summary
{{ai:gpt4:resumen_ejecutivo}}
<!-- AI_PROMPT FOR {{ai:gpt4:resumen_ejecutivo}}: 
Genera un resumen ejecutivo conciso (máximo 200 palabras) del proyecto [[project:nombre]].
Destaca el objetivo principal, el valor para el cliente y los resultados esperados.
-->

## Contexto de Mercado | Market Context
{{api:market:datos_industria}}
<!-- API_SOURCE: https://api.market.com/v1/industry?sector=[[org:industria]]&date={{project:fecha_inicio}} -->

<!-- KMC_DEFINITION FOR [{doc:analisis_tendencias}]:
GENERATIVE_SOURCE = {{ai:gpt4:analisis_tendencias}}
PROMPT = "Analiza las siguientes tendencias de mercado y explica cómo afectan al proyecto:
{{api:market:datos_industria}}"
FORMAT = "markdown"
-->

### Análisis de Tendencias | Trend Analysis
[{doc:analisis_tendencias}]

## Entregables | Deliverables
{{#each project:entregables}}
- **[{doc:nombre_entregable}]:** [{doc:descripcion_entregable}]
  *Fecha de entrega | Delivery date:* [{doc:fecha_entrega_entregable}]
  *Estado | Status:* {{tool:workflow:estado_entregable}}
{{/each}}

{{#if project:tiene_riesgos_identificados}}
## Análisis de Riesgos | Risk Analysis
{{ai:gpt4:analisis_riesgos}}
<!-- AI_PROMPT FOR {{ai:gpt4:analisis_riesgos}}: 
Identifica los 3 principales riesgos del proyecto y sugiere estrategias de mitigación para cada uno.
-->
{{/if}}

## Referencias | References
1. [{kb:documento_referencia_1}]
2. [{kb:documento_referencia_2}]

<!-- KMC_DEFINITION FOR [{doc:glosario}]:
GENERATIVE_SOURCE = {{ai:gpt4:glosario}}
PROMPT = "Genera un glosario de términos técnicos relevantes para este proyecto.
Formato: término - definición breve"
FORMAT = "markdown; definition_list"
-->

## Apéndice: Glosario | Appendix: Glossary
[{doc:glosario}]
```

## 7. Mejores Prácticas | Best Practices

1. **Nombrado de Variables | Variable Naming:**
   - Usa `snake_case` para todas las variables | Use `snake_case` for all variables
   - Nombres descriptivos pero concisos | Descriptive but concise names
   - Mantén consistencia en toda la plantilla | Maintain consistency throughout the template

2. **Prompts Efectivos | Effective Prompts:**
   - Sé específico sobre el formato deseado | Be specific about the desired format
   - Incluye contexto relevante | Include relevant context
   - Establece límites claros (longitud, estilo, tono) | Set clear limits (length, style, tone)

3. **Estructura del Documento | Document Structure:**
   - Usa encabezados jerárquicos (# para título, ## para secciones principales) | Use hierarchical headings (# for title, ## for main sections)
   - Coloca las definiciones KMC_DEFINITION antes de usar las variables | Place KMC_DEFINITION before using the variables
   - Agrupa variables relacionadas en secciones lógicas | Group related variables in logical sections

4. **Encadenamiento | Chaining:**
   - Evita ciclos de dependencias entre variables | Avoid dependency cycles between variables
   - Ordena las variables lógicamente (datos → análisis → recomendaciones) | Order variables logically (data → analysis → recommendations)
   - Documenta claramente las dependencias complejas | Clearly document complex dependencies

5. **Uso de KMC_DEFINITION | Using KMC_DEFINITION:**
   - Prefiere la sintaxis KMC_DEFINITION para relacionar variables de metadata con fuentes generativas | Prefer KMC_DEFINITION syntax to relate metadata variables with generative sources
   - Define templates para patrones repetitivos | Define templates for repetitive patterns
   - Especifica claramente los formatos esperados | Clearly specify expected formats